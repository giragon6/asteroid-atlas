import { useEffect, useState } from "react";
import AsteroidValue from "../types/AsteroidValue";

type AsteroidResponse = {
  links: {
    next: string;
    previous: string;
    self: string;
  };
  element_count: number;
  near_earth_objects: {
    [key: string]: AsteroidValue[];
  };
};

// TODO: Remove temp
async function fetchAsteroidData(
  startDate: Date,
  endDate: Date
): Promise<AsteroidResponse | null> {
  const tempData = '{"links":{"next":"http://api.nasa.gov/neo/rest/v1/feed?start_date=2024-11-18&end_date=2024-11-18&detailed=false&api_key=diRWa7NMi0bYHNQG6RjXTaDYIUphJpYCwBBD1AHL","prev":"http://api.nasa.gov/neo/rest/v1/feed?start_date=2024-11-16&end_date=2024-11-16&detailed=false&api_key=diRWa7NMi0bYHNQG6RjXTaDYIUphJpYCwBBD1AHL","self":"http://api.nasa.gov/neo/rest/v1/feed?start_date=2024-11-17&end_date=2024-11-17&detailed=false&api_key=diRWa7NMi0bYHNQG6RjXTaDYIUphJpYCwBBD1AHL"},"element_count":15,"near_earth_objects":{"2024-11-17":[{"links":{"self":"http://api.nasa.gov/neo/rest/v1/neo/3300165?api_key=diRWa7NMi0bYHNQG6RjXTaDYIUphJpYCwBBD1AHL"},"id":"3300165","neo_reference_id":"3300165","name":"(2005 WA)","nasa_jpl_url":"https://ssd.jpl.nasa.gov/tools/sbdb_lookup.html#/?sstr=3300165","absolute_magnitude_h":23.9,"estimated_diameter":{"kilometers":{"estimated_diameter_min":0.04411182,"estimated_diameter_max":0.0986370281},"meters":{"estimated_diameter_min":44.1118199997,"estimated_diameter_max":98.6370281305},"miles":{"estimated_diameter_min":0.0274098057,"estimated_diameter_max":0.0612901888},"feet":{"estimated_diameter_min":144.7238235278,"estimated_diameter_max":323.6123073718}},"is_potentially_hazardous_asteroid":false,"close_approach_data":[{"close_approach_date":"2024-11-17","close_approach_date_full":"2024-Nov-17 06:26","epoch_date_close_approach":1731824760000,"relative_velocity":{"kilometers_per_second":"9.5971632314","kilometers_per_hour":"34549.7876328972","miles_per_hour":"21467.8944322299"},"miss_distance":{"astronomical":"0.0643585565","lunar":"25.0354784785","kilometers":"9627902.968674655","miles":"5982501.492454039"},"orbiting_body":"Earth"}],"is_sentry_object":false},{"links":{"self":"http://api.nasa.gov/neo/rest/v1/neo/3338368?api_key=diRWa7NMi0bYHNQG6RjXTaDYIUphJpYCwBBD1AHL"},"id":"3338368","neo_reference_id":"3338368","name":"(2006 QQ23)","nasa_jpl_url":"https://ssd.jpl.nasa.gov/tools/sbdb_lookup.html#/?sstr=3338368","absolute_magnitude_h":19.71,"estimated_diameter":{"kilometers":{"estimated_diameter_min":0.3037770614,"estimated_diameter_max":0.6792661593},"meters":{"estimated_diameter_min":303.7770613871,"estimated_diameter_max":679.2661592667},"miles":{"estimated_diameter_min":0.1887582564,"estimated_diameter_max":0.4220762926},"feet":{"estimated_diameter_min":996.6439340813,"estimated_diameter_max":2228.5635859687}},"is_potentially_hazardous_asteroid":true,"close_approach_data":[{"close_approach_date":"2024-11-17","close_approach_date_full":"2024-Nov-17 18:38","epoch_date_close_approach":1731868680000,"relative_velocity":{"kilometers_per_second":"7.3835740764","kilometers_per_hour":"26580.8666750328","miles_per_hour":"16516.3168514947"},"miss_distance":{"astronomical":"0.3115665533","lunar":"121.1993892337","kilometers":"46609692.736921471","miles":"28961920.0846434598"},"orbiting_body":"Earth"}],"is_sentry_object":false},{"links":{"self":"http://api.nasa.gov/neo/rest/v1/neo/3758924?api_key=diRWa7NMi0bYHNQG6RjXTaDYIUphJpYCwBBD1AHL"},"id":"3758924","neo_reference_id":"3758924","name":"(2016 RP1)","nasa_jpl_url":"https://ssd.jpl.nasa.gov/tools/sbdb_lookup.html#/?sstr=3758924","absolute_magnitude_h":20.79,"estimated_diameter":{"kilometers":{"estimated_diameter_min":0.1847374636,"estimated_diameter_max":0.4130855266},"meters":{"estimated_diameter_min":184.7374636151,"estimated_diameter_max":413.0855266343},"miles":{"estimated_diameter_min":0.1147905025,"estimated_diameter_max":0.2566793668},"feet":{"estimated_diameter_min":606.094060127,"estimated_diameter_max":1355.2675192028}},"is_potentially_hazardous_asteroid":false,"close_approach_data":[{"close_approach_date":"2024-11-17","close_approach_date_full":"2024-Nov-17 20:54","epoch_date_close_approach":1731876840000,"relative_velocity":{"kilometers_per_second":"1.6076836132","kilometers_per_hour":"5787.6610074521","miles_per_hour":"3596.2274743249"},"miss_distance":{"astronomical":"0.4166321301","lunar":"162.0698986089","kilometers":"62327279.236522887","miles":"38728375.4589423606"},"orbiting_body":"Earth"}],"is_sentry_object":false},{"links":{"self":"http://api.nasa.gov/neo/rest/v1/neo/3774011?api_key=diRWa7NMi0bYHNQG6RjXTaDYIUphJpYCwBBD1AHL"},"id":"3774011","neo_reference_id":"3774011","name":"(2017 HC1)","nasa_jpl_url":"https://ssd.jpl.nasa.gov/tools/sbdb_lookup.html#/?sstr=3774011","absolute_magnitude_h":20.97,"estimated_diameter":{"kilometers":{"estimated_diameter_min":0.1700415193,"estimated_diameter_max":0.3802243961},"meters":{"estimated_diameter_min":170.0415192713,"estimated_diameter_max":380.2243960879},"miles":{"estimated_diameter_min":0.1056588689,"estimated_diameter_max":0.2362604132},"feet":{"estimated_diameter_min":557.879018086,"estimated_diameter_max":1247.4554076612}},"is_potentially_hazardous_asteroid":false,"close_approach_data":[{"close_approach_date":"2024-11-17","close_approach_date_full":"2024-Nov-17 07:51","epoch_date_close_approach":1731829860000,"relative_velocity":{"kilometers_per_second":"30.8190800035","kilometers_per_hour":"110948.6880126155","miles_per_hour":"68939.2000598388"},"miss_distance":{"astronomical":"0.1041651532","lunar":"40.5202445948","kilometers":"15582885.046943684","miles":"9682755.7728194792"},"orbiting_body":"Earth"}],"is_sentry_object":false},{"links":{"self":"http://api.nasa.gov/neo/rest/v1/neo/3789638?api_key=diRWa7NMi0bYHNQG6RjXTaDYIUphJpYCwBBD1AHL"},"id":"3789638","neo_reference_id":"3789638","name":"(2017 WU13)","nasa_jpl_url":"https://ssd.jpl.nasa.gov/tools/sbdb_lookup.html#/?sstr=3789638","absolute_magnitude_h":20.87,"estimated_diameter":{"kilometers":{"estimated_diameter_min":0.1780553292,"estimated_diameter_max":0.3981438198},"meters":{"estimated_diameter_min":178.0553291829,"estimated_diameter_max":398.1438198091},"miles":{"estimated_diameter_min":0.1106384179,"estimated_diameter_max":0.2473950235},"feet":{"estimated_diameter_min":584.1710461965,"estimated_diameter_max":1306.2461697825}},"is_potentially_hazardous_asteroid":false,"close_approach_data":[{"close_approach_date":"2024-11-17","close_approach_date_full":"2024-Nov-17 21:45","epoch_date_close_approach":1731879900000,"relative_velocity":{"kilometers_per_second":"6.013829091","kilometers_per_hour":"21649.7847276908","miles_per_hour":"13452.3342937143"},"miss_distance":{"astronomical":"0.3850086671","lunar":"149.7683715019","kilometers":"57596476.529699077","miles":"35788790.9672661826"},"orbiting_body":"Earth"}],"is_sentry_object":false},{"links":{"self":"http://api.nasa.gov/neo/rest/v1/neo/3892271?api_key=diRWa7NMi0bYHNQG6RjXTaDYIUphJpYCwBBD1AHL"},"id":"3892271","neo_reference_id":"3892271","name":"(2019 VT)","nasa_jpl_url":"https://ssd.jpl.nasa.gov/tools/sbdb_lookup.html#/?sstr=3892271","absolute_magnitude_h":24.5,"estimated_diameter":{"kilometers":{"estimated_diameter_min":0.0334622374,"estimated_diameter_max":0.0748238376},"meters":{"estimated_diameter_min":33.4622374455,"estimated_diameter_max":74.8238376074},"miles":{"estimated_diameter_min":0.0207924639,"estimated_diameter_max":0.0464933628},"feet":{"estimated_diameter_min":109.7842471007,"estimated_diameter_max":245.4850393757}},"is_potentially_hazardous_asteroid":false,"close_approach_data":[{"close_approach_date":"2024-11-17","close_approach_date_full":"2024-Nov-17 08:26","epoch_date_close_approach":1731831960000,"relative_velocity":{"kilometers_per_second":"14.0355686235","kilometers_per_hour":"50528.0470446803","miles_per_hour":"31396.163453957"},"miss_distance":{"astronomical":"0.3633966528","lunar":"141.3612979392","kilometers":"54363365.224009536","miles":"33779828.7587261568"},"orbiting_body":"Earth"}],"is_sentry_object":false},{"links":{"self":"http://api.nasa.gov/neo/rest/v1/neo/54049794?api_key=diRWa7NMi0bYHNQG6RjXTaDYIUphJpYCwBBD1AHL"},"id":"54049794","neo_reference_id":"54049794","name":"(2020 OY4)","nasa_jpl_url":"https://ssd.jpl.nasa.gov/tools/sbdb_lookup.html#/?sstr=54049794","absolute_magnitude_h":30.35,"estimated_diameter":{"kilometers":{"estimated_diameter_min":0.0022623249,"estimated_diameter_max":0.0050587123},"meters":{"estimated_diameter_min":2.2623249055,"estimated_diameter_max":5.058712276},"miles":{"estimated_diameter_min":0.0014057431,"estimated_diameter_max":0.0031433371},"feet":{"estimated_diameter_min":7.4223260431,"estimated_diameter_max":16.5968255835}},"is_potentially_hazardous_asteroid":false,"close_approach_data":[{"close_approach_date":"2024-11-17","close_approach_date_full":"2024-Nov-17 13:52","epoch_date_close_approach":1731851520000,"relative_velocity":{"kilometers_per_second":"14.2857007522","kilometers_per_hour":"51428.5227078019","miles_per_hour":"31955.6840125228"},"miss_distance":{"astronomical":"0.3666228227","lunar":"142.6162780303","kilometers":"54845993.369307649","miles":"34079719.9820735962"},"orbiting_body":"Earth"}],"is_sentry_object":false},{"links":{"self":"http://api.nasa.gov/neo/rest/v1/neo/54053707?api_key=diRWa7NMi0bYHNQG6RjXTaDYIUphJpYCwBBD1AHL"},"id":"54053707","neo_reference_id":"54053707","name":"(2020 QV6)","nasa_jpl_url":"https://ssd.jpl.nasa.gov/tools/sbdb_lookup.html#/?sstr=54053707","absolute_magnitude_h":22.38,"estimated_diameter":{"kilometers":{"estimated_diameter_min":0.0888290416,"estimated_diameter_max":0.1986277755},"meters":{"estimated_diameter_min":88.8290416389,"estimated_diameter_max":198.6277754808},"miles":{"estimated_diameter_min":0.0551957904,"estimated_diameter_max":0.1234215395},"feet":{"estimated_diameter_min":291.4338729707,"estimated_diameter_max":651.6659509085}},"is_potentially_hazardous_asteroid":false,"close_approach_data":[{"close_approach_date":"2024-11-17","close_approach_date_full":"2024-Nov-17 08:51","epoch_date_close_approach":1731833460000,"relative_velocity":{"kilometers_per_second":"28.4782323594","kilometers_per_hour":"102521.636493835","miles_per_hour":"63702.9579647387"},"miss_distance":{"astronomical":"0.310242369","lunar":"120.684281541","kilometers":"46411597.58615403","miles":"28838829.465744414"},"orbiting_body":"Earth"}],"is_sentry_object":false},{"links":{"self":"http://api.nasa.gov/neo/rest/v1/neo/54225730?api_key=diRWa7NMi0bYHNQG6RjXTaDYIUphJpYCwBBD1AHL"},"id":"54225730","neo_reference_id":"54225730","name":"(2021 WF6)","nasa_jpl_url":"https://ssd.jpl.nasa.gov/tools/sbdb_lookup.html#/?sstr=54225730","absolute_magnitude_h":23.61,"estimated_diameter":{"kilometers":{"estimated_diameter_min":0.0504144434,"estimated_diameter_max":0.1127301225},"meters":{"estimated_diameter_min":50.4144433858,"estimated_diameter_max":112.7301224584},"miles":{"estimated_diameter_min":0.0313260731,"estimated_diameter_max":0.0700472289},"feet":{"estimated_diameter_min":165.4017224378,"estimated_diameter_max":369.8494949666}},"is_potentially_hazardous_asteroid":false,"close_approach_data":[{"close_approach_date":"2024-11-17","close_approach_date_full":"2024-Nov-17 15:39","epoch_date_close_approach":1731857940000,"relative_velocity":{"kilometers_per_second":"13.4781207774","kilometers_per_hour":"48521.2347985136","miles_per_hour":"30149.2083668875"},"miss_distance":{"astronomical":"0.2391067884","lunar":"93.0125406876","kilometers":"35769866.247180708","miles":"22226364.2357934504"},"orbiting_body":"Earth"}],"is_sentry_object":false},{"links":{"self":"http://api.nasa.gov/neo/rest/v1/neo/54347928?api_key=diRWa7NMi0bYHNQG6RjXTaDYIUphJpYCwBBD1AHL"},"id":"54347928","neo_reference_id":"54347928","name":"(2023 EO1)","nasa_jpl_url":"https://ssd.jpl.nasa.gov/tools/sbdb_lookup.html#/?sstr=54347928","absolute_magnitude_h":24.47,"estimated_diameter":{"kilometers":{"estimated_diameter_min":0.0339277435,"estimated_diameter_max":0.0758647409},"meters":{"estimated_diameter_min":33.9277435382,"estimated_diameter_max":75.8647408746},"miles":{"estimated_diameter_min":0.0210817159,"estimated_diameter_max":0.0471401499},"feet":{"estimated_diameter_min":111.3114981099,"estimated_diameter_max":248.900076451}},"is_potentially_hazardous_asteroid":false,"close_approach_data":[{"close_approach_date":"2024-11-17","close_approach_date_full":"2024-Nov-17 06:39","epoch_date_close_approach":1731825540000,"relative_velocity":{"kilometers_per_second":"27.0550604035","kilometers_per_hour":"97398.2174527451","miles_per_hour":"60519.4646166793"},"miss_distance":{"astronomical":"0.2330964171","lunar":"90.6745062519","kilometers":"34870727.502791577","miles":"21667665.3272426826"},"orbiting_body":"Earth"}],"is_sentry_object":false},{"links":{"self":"http://api.nasa.gov/neo/rest/v1/neo/54404389?api_key=diRWa7NMi0bYHNQG6RjXTaDYIUphJpYCwBBD1AHL"},"id":"54404389","neo_reference_id":"54404389","name":"(2023 VC7)","nasa_jpl_url":"https://ssd.jpl.nasa.gov/tools/sbdb_lookup.html#/?sstr=54404389","absolute_magnitude_h":25.86,"estimated_diameter":{"kilometers":{"estimated_diameter_min":0.0178877195,"estimated_diameter_max":0.0399981568},"meters":{"estimated_diameter_min":17.887719524,"estimated_diameter_max":39.9981568182},"miles":{"estimated_diameter_min":0.0111149102,"estimated_diameter_max":0.0248536947},"feet":{"estimated_diameter_min":58.6867457232,"estimated_diameter_max":131.2275528154}},"is_potentially_hazardous_asteroid":false,"close_approach_data":[{"close_approach_date":"2024-11-17","close_approach_date_full":"2024-Nov-17 11:53","epoch_date_close_approach":1731844380000,"relative_velocity":{"kilometers_per_second":"5.3002551387","kilometers_per_hour":"19080.918499389","miles_per_hour":"11856.1407198009"},"miss_distance":{"astronomical":"0.1393415517","lunar":"54.2038636113","kilometers":"20845199.336814879","miles":"12952606.2475641702"},"orbiting_body":"Earth"}],"is_sentry_object":false},{"links":{"self":"http://api.nasa.gov/neo/rest/v1/neo/54433337?api_key=diRWa7NMi0bYHNQG6RjXTaDYIUphJpYCwBBD1AHL"},"id":"54433337","neo_reference_id":"54433337","name":"(2024 GM2)","nasa_jpl_url":"https://ssd.jpl.nasa.gov/tools/sbdb_lookup.html#/?sstr=54433337","absolute_magnitude_h":23.2,"estimated_diameter":{"kilometers":{"estimated_diameter_min":0.0608912622,"estimated_diameter_max":0.1361570015},"meters":{"estimated_diameter_min":60.8912622106,"estimated_diameter_max":136.1570015386},"miles":{"estimated_diameter_min":0.0378360645,"estimated_diameter_max":0.0846040122},"feet":{"estimated_diameter_min":199.7744887109,"estimated_diameter_max":446.7093369279}},"is_potentially_hazardous_asteroid":false,"close_approach_data":[{"close_approach_date":"2024-11-17","close_approach_date_full":"2024-Nov-17 17:02","epoch_date_close_approach":1731862920000,"relative_velocity":{"kilometers_per_second":"19.7362339826","kilometers_per_hour":"71050.4423372063","miles_per_hour":"44147.9817955824"},"miss_distance":{"astronomical":"0.4107979481","lunar":"159.8004018109","kilometers":"61454498.036130547","miles":"38186054.3687816686"},"orbiting_body":"Earth"}],"is_sentry_object":false},{"links":{"self":"http://api.nasa.gov/neo/rest/v1/neo/54496021?api_key=diRWa7NMi0bYHNQG6RjXTaDYIUphJpYCwBBD1AHL"},"id":"54496021","neo_reference_id":"54496021","name":"(2024 UC5)","nasa_jpl_url":"https://ssd.jpl.nasa.gov/tools/sbdb_lookup.html#/?sstr=54496021","absolute_magnitude_h":26.296,"estimated_diameter":{"kilometers":{"estimated_diameter_min":0.0146337279,"estimated_diameter_max":0.0327220104},"meters":{"estimated_diameter_min":14.6337279377,"estimated_diameter_max":32.722010433},"miles":{"estimated_diameter_min":0.0090929742,"estimated_diameter_max":0.0203325083},"feet":{"estimated_diameter_min":48.0109199672,"estimated_diameter_max":107.355680709}},"is_potentially_hazardous_asteroid":false,"close_approach_data":[{"close_approach_date":"2024-11-17","close_approach_date_full":"2024-Nov-17 21:47","epoch_date_close_approach":1731880020000,"relative_velocity":{"kilometers_per_second":"4.2364134395","kilometers_per_hour":"15251.0883821254","miles_per_hour":"9476.4332227712"},"miss_distance":{"astronomical":"0.0277677299","lunar":"10.8016469311","kilometers":"4153993.247775313","miles":"2581171.7136447994"},"orbiting_body":"Earth"}],"is_sentry_object":false},{"links":{"self":"http://api.nasa.gov/neo/rest/v1/neo/54496620?api_key=diRWa7NMi0bYHNQG6RjXTaDYIUphJpYCwBBD1AHL"},"id":"54496620","neo_reference_id":"54496620","name":"(2024 UM9)","nasa_jpl_url":"https://ssd.jpl.nasa.gov/tools/sbdb_lookup.html#/?sstr=54496620","absolute_magnitude_h":20.75,"estimated_diameter":{"kilometers":{"estimated_diameter_min":0.1881719895,"estimated_diameter_max":0.42076536},"meters":{"estimated_diameter_min":188.1719894893,"estimated_diameter_max":420.7653599595},"miles":{"estimated_diameter_min":0.1169246173,"estimated_diameter_max":0.2614513925},"feet":{"estimated_diameter_min":617.3621899961,"estimated_diameter_max":1380.4638235694}},"is_potentially_hazardous_asteroid":false,"close_approach_data":[{"close_approach_date":"2024-11-17","close_approach_date_full":"2024-Nov-17 15:03","epoch_date_close_approach":1731855780000,"relative_velocity":{"kilometers_per_second":"13.5773467007","kilometers_per_hour":"48878.4481226269","miles_per_hour":"30371.1668348623"},"miss_distance":{"astronomical":"0.2422749492","lunar":"94.2449552388","kilometers":"36243816.354678204","miles":"22520863.1764950552"},"orbiting_body":"Earth"}],"is_sentry_object":false},{"links":{"self":"http://api.nasa.gov/neo/rest/v1/neo/54499275?api_key=diRWa7NMi0bYHNQG6RjXTaDYIUphJpYCwBBD1AHL"},"id":"54499275","neo_reference_id":"54499275","name":"(2024 VZ2)","nasa_jpl_url":"https://ssd.jpl.nasa.gov/tools/sbdb_lookup.html#/?sstr=54499275","absolute_magnitude_h":26.066,"estimated_diameter":{"kilometers":{"estimated_diameter_min":0.0162687796,"estimated_diameter_max":0.0363780972},"meters":{"estimated_diameter_min":16.2687796368,"estimated_diameter_max":36.3780971788},"miles":{"estimated_diameter_min":0.0101089479,"estimated_diameter_max":0.0226042946},"feet":{"estimated_diameter_min":53.3752629835,"estimated_diameter_max":119.3507163481}},"is_potentially_hazardous_asteroid":false,"close_approach_data":[{"close_approach_date":"2024-11-17","close_approach_date_full":"2024-Nov-17 01:28","epoch_date_close_approach":1731806880000,"relative_velocity":{"kilometers_per_second":"10.2063645356","kilometers_per_hour":"36742.9123281452","miles_per_hour":"22830.6168296745"},"miss_distance":{"astronomical":"0.0084991321","lunar":"3.3061623869","kilometers":"1271452.059008627","miles":"790043.6746559726"},"orbiting_body":"Earth"}],"is_sentry_object":false}]}}';
  return (JSON.parse(tempData) as AsteroidResponse) || null;
  // var API_URL: string;
  // const fmtStartDate = startDate.toLocaleDateString("fr-CA", {
  //   year: "numeric",
  //   month: "2-digit",
  //   day: "2-digit",
  // });
  // const fmtEndDate = endDate.toLocaleDateString("fr-CA", {
  //   year: "numeric",
  //   month: "2-digit",
  //   day: "2-digit",
  // });

  // API_URL = `https://api.nasa.gov/neo/rest/v1/feed?start_date=${fmtStartDate}&end_date=${fmtEndDate}&api_key=${
  //   import.meta.env.VITE_NASA_API_KEY
  // }`;

  // try {
  //   // Make the fetch request
  //   return fetch(API_URL)
  //     .then((response) => {
  //       if (!response.ok) {
  //         throw new Error(`HTTP error! status: ${response.status}`);
  //       }
  //       return response.json();
  //     })
  //     .then((response) => {
  //       if (response == null) {
  //         throw new Error("Error parsing request");
  //       }
  //       return response;
  //     })
  //     .then((response) => {
  //       return (response as AsteroidResponse) || null;
  //     });
  // } catch (error) {
  //   console.error("Fetch error:", error);
  //   return null;
  // }
}

function useData(
  startDate: Date,
  endDate: Date
): [AsteroidResponse | null, string | null] {
  const [data, setData] = useState<AsteroidResponse | null>(null);
  const [error, setError] = useState<string | null>(null);

  try {
    useEffect(() => {
      fetchAsteroidData(startDate, endDate).then((response) => {
        if (response) {
          setData(response as AsteroidResponse);
        } else {
          setError("No data found or an error occurred");
          console.log(`Error fetching data: ${error}`);
        }
      });
    }, []);
  } catch (e) {
    setError(`Error fetching data: ${e}`);
  }
  return [data, error];
}

export default useData;
